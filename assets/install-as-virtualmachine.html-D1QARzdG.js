import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as e,c as a,a as i}from"./app-BK8bPqMn.js";const n="/assets/vmware-identification-error-B_mCoex1.png",l="/assets/vmware-choose-system-BGJxqwR7.png",r="/assets/vmware-tools-sync-time-CN0ubOS1.png",o="/assets/virtualbox-virtualmachine-settings-Dqq_unuJ.png",d="/assets/virtualbox-settings-DB1zNGmi.png",t="/assets/disable-security-boot-WF8zGUhI.png",c="/assets/enable-guest-service-4UZlz9DM.png",p="/assets/disable-auto-checkpoint-7JSXhHd7.png",h={},u=i('<h1 id="第-4-节-在虚拟机中安装-freebsd" tabindex="-1"><a class="header-anchor" href="#第-4-节-在虚拟机中安装-freebsd"><span>第 4 节 在虚拟机中安装 FreeBSD</span></a></h1><p>在各种虚拟机中安装 FreeBSD 的流程相同。这里仅介绍新建虚拟机的选项和安装后的配置。</p><h2 id="总体建议" tabindex="-1"><a class="header-anchor" href="#总体建议"><span>总体建议</span></a></h2><p>建议都使用 UEFI，开机速度更快，终端更大更好看。</p><h2 id="在-vmware-workstation-pro-中安装-freebsd" tabindex="-1"><a class="header-anchor" href="#在-vmware-workstation-pro-中安装-freebsd"><span>在 VMware Workstation Pro 中安装 FreeBSD</span></a></h2><p>使用的 VMware Workstation Pro 版本为 17.5.0。</p><p>VMware Workstation Pro 的下载、安装和使用不在本教程讨论范围内，请自行学习。</p><p>对于 VMware Workstation Player，具体操作相同。</p><h3 id="vmware-虚拟机设置" tabindex="-1"><a class="header-anchor" href="#vmware-虚拟机设置"><span>VMware 虚拟机设置</span></a></h3><p>创建新的虚拟机，一路到选择安装来源。这里要选择稍后安装操作系统。因为 VMware Workstation Pro 无法正确识别 FreeBSD 的版本。</p><figure><img src="'+n+'" alt="VMware Workstation Pro 将 FreeBSD 14.0 识别为了 FreeBSD 10 和更早版本" tabindex="0"><figcaption>VMware Workstation Pro 将 FreeBSD 14.0 识别为了 FreeBSD 10 和更早版本</figcaption></figure><p>在下一步的系统选择中选择正确的版本。</p><figure><img src="'+l+`" alt="选择正确的 FreeBSD 14 64 位" tabindex="0"><figcaption>选择正确的 FreeBSD 14 64 位</figcaption></figure><p>设置硬盘大小，默认的 20G 对基本系统来说绰绰有余，但如果你想要安装桌面和其他程序，则显得有点捉襟见肘。建议分配 40G 以上。</p><p>默认的 256M 内存也显得 VMware Workstation Pro 很傻。虽然确实能运行起来，但也仅限于此。对 ZFS 来说也显得太小了（不过真的能跑。这也间接证明了 ZFS 实际上并不刚需大内存）。建议至少分配 1G，如果你想运行桌面建议分配 4G 以上。</p><h3 id="vmware-增强工具安装与使用" tabindex="-1"><a class="header-anchor" href="#vmware-增强工具安装与使用"><span>VMware 增强工具安装与使用</span></a></h3><p>如果安装桌面</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # pkg install open-vm-tools xf86-input-vmmouse xf86-video-vmware</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果不安装桌面</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # pkg install open-vm-tools-nox11</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>安装后重启</p><h4 id="vmware-共享文件夹配置" tabindex="-1"><a class="header-anchor" href="#vmware-共享文件夹配置"><span>VMware 共享文件夹配置</span></a></h4><p>安装增强工具后，在 VMware Workstation Pro 中添加一个共享文件夹，例如 <code>share</code>。同时执行</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # sysrc kld_list+=</span><span style="color:#A31515;--shiki-dark:#CE9178;">&quot;fusefs&quot;</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">kld_list:  -&gt; fusefs</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # kldload fusefs</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看当前启用的共享文件夹：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">alex11@freebsd:~ $ vmware-hgfsclient</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">share</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>挂载共享文件夹：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # mkdir /mnt/vmware-share</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # vmhgfs-fuse .host:/share /mnt/vmware-share</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>即将共享文件夹 <code>share</code> 挂载到了 <code>/mnt/vmware-share/</code></p><p>挂载所有共享文件夹：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # mkdir /mnt/vmware-share</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # vmhgfs-fuse /mnt/vmware-share</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>即将所有共享文件夹挂载到了 <code>/mnt/vmware-share</code>，每个共享文件夹有一个子目录。</p><p>查看挂载的共享文件夹：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">alex11@freebsd:~ # mount</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">...</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">vmhgfs-fuse on /mnt/vmware-share (fusefs)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>卸载共享文件夹：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # umount /mnt/vmware-share</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>自动挂载共享文件夹：</p><p><code>root</code> 编辑 <code>/etc/fstab</code>，添加以下内容：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span>.host:/share  /mnt/vmware-share  fusefs  rw,late,mountprog=/usr/local/bin/vmhgfs-fuse  0  0</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>自动挂载全部共享文件夹：</p><p><code>root</code> 编辑 <code>/etc/fstab</code>，添加：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span>.host:/  /mnt/vmware-share  fusefs  rw,late,mountprog=/usr/local/bin/vmhgfs-fuse  0  0</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用 <code>mount -al</code> 检查配置是否正确。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>由于启动过程中加载 <code>/etc/rc.conf</code> 中的 <code>kld_list</code> 项的时间晚于 <code>/etc/fstab</code> 中无 <code>late</code> 选项的文件系统的挂载时间，如果没有在加 <code>/etc/fstab</code> 条目中加 <code>late</code>，则必须在 <code>/boot/loader.conf</code> 中写入 <code>fusefs_load=&quot;YES&quot;</code>，否则在没有加载 <code>fusefs.ko</code> 的时候尝试挂载共享文件夹会失败导致系统进入单用户模式。如果已经进入了单用户模式，可以回车进入命令行，执行 <code>kldload fusefs</code> 加载内核模块后用 <code>exit</code> 退出，FreeBSD 会继续尝试多用户启动。之后修改 <code>/etc/fstab</code> 或 <code>/boot/loader.conf</code> 即可。</p></div><div class="hint-container info"><p class="hint-container-title">提示</p><p><code>fstab</code> 项目中的 <code>rw</code> 选项并不一定保证共享文件夹一定可以写入。如果在 VMware 的共享文件夹设置中选择了只读，那么同样是无法写入的。如果改成 <code>ro</code>，则无论 VMware 的设置如何，都无法写入。<code>rw</code> 或 <code>ro</code> 是必须的，不能删掉。</p></div><h4 id="vmware-桌面大小调整与鼠标集成" tabindex="-1"><a class="header-anchor" href="#vmware-桌面大小调整与鼠标集成"><span>VMware 桌面大小调整与鼠标集成</span></a></h4><div class="hint-container info"><p class="hint-container-title">注意</p><p>只有启动桌面的情况下才能实现桌面大小自动调整和鼠标集成，命令行无法实现。</p></div><p>安装增强工具后无需配置即可实现桌面大小自动调整。</p><p>实现鼠标集成：</p><p>生成 Xorg 配置文件：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # Xorg -configure</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">...</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">To test the server, run &#39;X -config /root/xorg.conf.new&#39;</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">...</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # mv /root/xorg.conf.new /etc/X11/xorg.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>如果出现</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span>(EE) Cannot establish any listening sockets - Make sure an X server isn&#39;t already running(EE)</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>的错误且没有生成 <code>/root/xorg.conf.new</code> ，请禁用所有桌面管理器服务如 <code>gdm</code> <code>sddm</code> 后重启系统，再次执行上面的命令。</p></div><p><code>root</code> 编辑 <code>/etc/X11/xorg.conf</code>，修改以下两个部分：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span>...</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Section &quot;ServerLayout&quot;</span></span>
<span class="line"><span>        Identifier     &quot;X.org Configured&quot;</span></span>
<span class="line"><span>        Screen          0  &quot;Screen0&quot; 0 0</span></span>
<span class="line"><span>        InputDevice    &quot;Mouse0&quot; &quot;CorePointer&quot;</span></span>
<span class="line"><span>        InputDevice    &quot;Keyboard0&quot; &quot;CoreKeyboard&quot;</span></span>
<span class="line"><span>        Option         &quot;AutoAddDevices&quot; &quot;Off&quot;  # 添加此行</span></span>
<span class="line"><span>EndSection</span></span>
<span class="line"><span></span></span>
<span class="line"><span>...</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Section &quot;InputDevice&quot;</span></span>
<span class="line"><span>      Identifier  &quot;Mouse0&quot;</span></span>
<span class="line"><span>      Driver      &quot;vmmouse&quot;  # 修改 mouse 为 vmmouse</span></span>
<span class="line"><span>      Option      &quot;Protocol&quot; &quot;auto&quot;</span></span>
<span class="line"><span>      Option      &quot;Device&quot; &quot;/dev/sysmouse&quot;</span></span>
<span class="line"><span>      Option      &quot;ZAxisMapping&quot; &quot;4 5 6 7&quot;</span></span>
<span class="line"><span>EndSection</span></span>
<span class="line"><span></span></span>
<span class="line"><span>...</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="vmware-中解决时间错误的问题" tabindex="-1"><a class="header-anchor" href="#vmware-中解决时间错误的问题"><span>VMware 中解决时间错误的问题</span></a></h3><p>由于 VMware Workstation Pro 将主机系统时间设为虚拟机硬件时间且无法更改，故 FreeBSD 中时间晚 8 小时的问题只能在 FreeBSD 内部解决。</p><h4 id="方法一-硬件时间视为本地时间" tabindex="-1"><a class="header-anchor" href="#方法一-硬件时间视为本地时间"><span>方法一：硬件时间视为本地时间</span></a></h4><p>创建 <code>/etc/wall_cmos_clock</code>：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # touch /etc/wall_cmos_clock</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>之后重启。</p><h4 id="方法二-使用增强工具同步时间" tabindex="-1"><a class="header-anchor" href="#方法二-使用增强工具同步时间"><span>方法二：使用增强工具同步时间</span></a></h4><p>安装增强工具后，在 <code>虚拟机设置</code> -&gt; <code>选项</code> -&gt; <code>VMware Tools</code> -&gt; <code>VMware Tools 功能</code> 选中 <code>将客户机时间与主机同步</code>。</p><figure><img src="`+r+'" alt="VMware 增强工具同步时间" tabindex="0"><figcaption>VMware 增强工具同步时间</figcaption></figure><h2 id="在-virtualbox-中安装-freebsd" tabindex="-1"><a class="header-anchor" href="#在-virtualbox-中安装-freebsd"><span>在 VirtualBox 中安装 FreeBSD</span></a></h2><p>使用的 VirtualBox 版本为 7.0.14。</p><p>VirtualBox 虚拟机的下载、安装和使用不在本文讨论范围内，请自行学习。</p><h3 id="virtualbox-虚拟机设置" tabindex="-1"><a class="header-anchor" href="#virtualbox-虚拟机设置"><span>VirtualBox 虚拟机设置</span></a></h3><p>类型选择 <code>BSD</code>，版本选择 <code>FreeBSD (64-bit)</code> 即可。如果你在虚拟机名称输入 <code>FreeBSD</code>，VirtualBox 还会帮你自动选择 😃</p><figure><img src="'+o+`" alt="VirtualBox 虚拟机类型选择" tabindex="0"><figcaption>VirtualBox 虚拟机类型选择</figcaption></figure><h3 id="virtualbox-增强工具安装与使用" tabindex="-1"><a class="header-anchor" href="#virtualbox-增强工具安装与使用"><span>VirtualBox 增强工具安装与使用</span></a></h3><p>如果安装桌面：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # pkg install virtualbox-ose-additions</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果不安装桌面：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # pkg install virtualbox-ose-additions-nox11</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动服务：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # sysrc vboxguest_enable=</span><span style="color:#A31515;--shiki-dark:#CE9178;">&quot;YES&quot;</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">vboxguest_enable:  -&gt; YES</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # sysrc vboxservices_enable=</span><span style="color:#A31515;--shiki-dark:#CE9178;">&quot;YES&quot;</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">vboxservices_enable:  -&gt; YES</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>之后重启。</p><h4 id="virtualbox-共享文件夹配置" tabindex="-1"><a class="header-anchor" href="#virtualbox-共享文件夹配置"><span>VirtualBox 共享文件夹配置</span></a></h4><p>在 VirtualBox 中新建共享文件夹，例如名称为 <code>share</code>。</p><div class="hint-container note"><p class="hint-container-title">注</p><p>共享文件夹的自动挂载似乎不起作用，所以不用设置挂载点和勾选自动挂载。</p></div><p>读写挂载（共享文件夹设置不能勾选只读挂载）：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # mkdir /mnt/virtualbox-share</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # mount_vboxvfs -w share /mnt/virtualbox-share</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>只读挂载：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # mkdir /mnt/virtualbox-share</span></span>
<span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # mount_vboxvfs -r share /mnt/virtualbox-share</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>卸载：</p><div class="language-shellsession line-numbers-mode" data-ext="shellsession" data-title="shellsession"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#000000;--shiki-dark:#D4D4D4;">root@freebsd:~ # umount /mnt/virtualbox-share</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>自动挂载：</p><p><code>root</code> 编辑 <code>/etc/fstab</code>，添加以下内容：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki shiki-themes light-plus dark-plus" style="background-color:#FFFFFF;--shiki-dark-bg:#1E1E1E;color:#000000;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span>share  /mnt/virtualbox-share  vboxvfs  rw  0  0</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">注意</p><p>VirtualBox 的共享文件夹似乎有一个 bug：在 FreeBSD 中修改（包括创建）的文件无法删除，在 FreeBSD 下提示 <code>Text file busy</code>，在 Windows 下提示 <code>操作无法完成，因为文件已在 VirtualBox Virtual Machine 中打开。</code> 必须重启虚拟机才能解除。没有经过 FreeBSD 编辑的文件则不会触发 bug，可以直接删除。</p></div><h3 id="解决-uefi-环境下无法正常关机的问题" tabindex="-1"><a class="header-anchor" href="#解决-uefi-环境下无法正常关机的问题"><span>解决 UEFI 环境下无法正常关机的问题</span></a></h3><p>编辑 <code>/etc/sysctl.conf</code>，添加一行 <code>hw.efi.poweroff=0</code>。强制关机后重启即可解决。</p><h3 id="virtualbox-中解决时间错误的问题" tabindex="-1"><a class="header-anchor" href="#virtualbox-中解决时间错误的问题"><span>VirtualBox 中解决时间错误的问题</span></a></h3><p>在虚拟机设置 <code>系统</code> 中选中 <code>扩展特性</code> -&gt; <code>硬件时钟使用国际标准时间(UTC)</code>。或按 VMware 中将硬件时间视为本地时间设置。</p><figure><img src="`+d+'" alt="更改 VirtualBox 设置" tabindex="0"><figcaption>更改 VirtualBox 设置</figcaption></figure><h2 id="在-hyper-v-中安装-freebsd" tabindex="-1"><a class="header-anchor" href="#在-hyper-v-中安装-freebsd"><span>在 Hyper-V 中安装 FreeBSD</span></a></h2><p>Hyper-V 虚拟机不支持共享文件夹，文件拖放，共享剪贴板，调整分辨率等。不建议新手使用。或者可以使用远程桌面。</p><h3 id="hyper-v-虚拟机代数建议" tabindex="-1"><a class="header-anchor" href="#hyper-v-虚拟机代数建议"><span>Hyper-V 虚拟机代数建议</span></a></h3><p>只建议使用 Gen 2。Gen 1 会在启动 Xorg 之后卡死。并且 FreeBSD 13 在 Gen 1 中不支持鼠标自动切换。当然用远程桌面的话也可以用 Gen 1。<s>有 UEFI 谁还会用 Legacy 呢？</s></p><h3 id="hyper-v-虚拟机与-freebsd-版本" tabindex="-1"><a class="header-anchor" href="#hyper-v-虚拟机与-freebsd-版本"><span>Hyper-V 虚拟机与 FreeBSD 版本</span></a></h3><p>FreeBSD 13.2 在 Hyper-V 中不能使用鼠标，FreeBSD 13.3 和 14 正常。</p><h3 id="hyper-v-虚拟机设置" tabindex="-1"><a class="header-anchor" href="#hyper-v-虚拟机设置"><span>Hyper-V 虚拟机设置</span></a></h3><p>必须在 <code>设置</code> -&gt; <code>安全</code> 中禁用安全启动。</p><figure><img src="'+t+'" alt="禁用安全启动" tabindex="0"><figcaption>禁用安全启动</figcaption></figure><p>可以在 <code>设置</code> -&gt; <code>集成服务</code> 中勾选 <code>来宾服务</code>。</p><figure><img src="'+c+'" alt="启用来宾服务" tabindex="0"><figcaption>启用来宾服务</figcaption></figure><p>可以在 <code>设置</code> -&gt; <code>检查点</code> 中取消勾选 <code>使用自动检查点</code>，否则每次开机都会自动创建检查点，一般是没有必要的。</p><figure><img src="'+p+'" alt="不自动创建检查点" tabindex="0"><figcaption>不自动创建检查点</figcaption></figure>',108),v=[u];function b(k,m){return e(),a("div",null,v)}const f=s(h,[["render",b],["__file","install-as-virtualmachine.html.vue"]]),F=JSON.parse('{"path":"/installation/install-as-virtualmachine.html","title":"第 4 节  在虚拟机中安装 FreeBSD","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"总体建议","slug":"总体建议","link":"#总体建议","children":[]},{"level":2,"title":"在 VMware Workstation Pro 中安装 FreeBSD","slug":"在-vmware-workstation-pro-中安装-freebsd","link":"#在-vmware-workstation-pro-中安装-freebsd","children":[{"level":3,"title":"VMware 虚拟机设置","slug":"vmware-虚拟机设置","link":"#vmware-虚拟机设置","children":[]},{"level":3,"title":"VMware 增强工具安装与使用","slug":"vmware-增强工具安装与使用","link":"#vmware-增强工具安装与使用","children":[{"level":4,"title":"VMware 共享文件夹配置","slug":"vmware-共享文件夹配置","link":"#vmware-共享文件夹配置","children":[]},{"level":4,"title":"VMware 桌面大小调整与鼠标集成","slug":"vmware-桌面大小调整与鼠标集成","link":"#vmware-桌面大小调整与鼠标集成","children":[]}]},{"level":3,"title":"VMware 中解决时间错误的问题","slug":"vmware-中解决时间错误的问题","link":"#vmware-中解决时间错误的问题","children":[{"level":4,"title":"方法一：硬件时间视为本地时间","slug":"方法一-硬件时间视为本地时间","link":"#方法一-硬件时间视为本地时间","children":[]},{"level":4,"title":"方法二：使用增强工具同步时间","slug":"方法二-使用增强工具同步时间","link":"#方法二-使用增强工具同步时间","children":[]}]}]},{"level":2,"title":"在 VirtualBox 中安装 FreeBSD","slug":"在-virtualbox-中安装-freebsd","link":"#在-virtualbox-中安装-freebsd","children":[{"level":3,"title":"VirtualBox 虚拟机设置","slug":"virtualbox-虚拟机设置","link":"#virtualbox-虚拟机设置","children":[]},{"level":3,"title":"VirtualBox 增强工具安装与使用","slug":"virtualbox-增强工具安装与使用","link":"#virtualbox-增强工具安装与使用","children":[{"level":4,"title":"VirtualBox 共享文件夹配置","slug":"virtualbox-共享文件夹配置","link":"#virtualbox-共享文件夹配置","children":[]}]},{"level":3,"title":"解决 UEFI 环境下无法正常关机的问题","slug":"解决-uefi-环境下无法正常关机的问题","link":"#解决-uefi-环境下无法正常关机的问题","children":[]},{"level":3,"title":"VirtualBox 中解决时间错误的问题","slug":"virtualbox-中解决时间错误的问题","link":"#virtualbox-中解决时间错误的问题","children":[]}]},{"level":2,"title":"在 Hyper-V 中安装 FreeBSD","slug":"在-hyper-v-中安装-freebsd","link":"#在-hyper-v-中安装-freebsd","children":[{"level":3,"title":"Hyper-V 虚拟机代数建议","slug":"hyper-v-虚拟机代数建议","link":"#hyper-v-虚拟机代数建议","children":[]},{"level":3,"title":"Hyper-V 虚拟机与 FreeBSD 版本","slug":"hyper-v-虚拟机与-freebsd-版本","link":"#hyper-v-虚拟机与-freebsd-版本","children":[]},{"level":3,"title":"Hyper-V 虚拟机设置","slug":"hyper-v-虚拟机设置","link":"#hyper-v-虚拟机设置","children":[]}]}],"git":{"createdTime":1710599288000,"updatedTime":1710599288000,"contributors":[{"name":"Alex6357","email":"73743056+Alex6357@users.noreply.github.com","commits":1}]},"readingTime":{"minutes":6.88,"words":2063},"filePathRelative":"installation/install-as-virtualmachine.md","localizedDate":"2024年3月16日","excerpt":"\\n<p>在各种虚拟机中安装 FreeBSD 的流程相同。这里仅介绍新建虚拟机的选项和安装后的配置。</p>\\n<h2>总体建议</h2>\\n<p>建议都使用 UEFI，开机速度更快，终端更大更好看。</p>\\n<h2>在 VMware Workstation Pro 中安装 FreeBSD</h2>\\n<p>使用的 VMware Workstation Pro 版本为 17.5.0。</p>\\n<p>VMware Workstation Pro 的下载、安装和使用不在本教程讨论范围内，请自行学习。</p>\\n<p>对于 VMware Workstation Player，具体操作相同。</p>\\n<h3>VMware 虚拟机设置</h3>"}');export{f as comp,F as data};
